# configs/components.yaml
selectors:
  # 动态数据选择器
  nice:
    name: nice
    params:
      cache_dir: ../dataflex_saves/nice_output
      gradient_type: adam
      proj_dim: 4096
      seed: 123
      reward_model_backend: local_vllm   # choices: [local_vllm, api]
      reward_backend_params:
        local_vllm:
          hf_model_name_or_path: meta-llama/Llama-3.1-8B
          vllm_tensor_parallel_size: 1
          vllm_temperature: 0.0
          vllm_top_p: 0.9
          vllm_max_tokens: 512
          vllm_top_k: 40
          vllm_seed: 42
          vllm_max_model_len: null
          vllm_gpu_memory_utilization: 0.9
        api:
          api_url: https://api.openai.com/v1/chat/completions
          api_key: DF_API_KEY
          model_name: gpt-4o
          temperature: 0.0    
      mc_samples: 4
      max_new_tokens: 512
      generation_temperature: 0.7
      max_prompt_length: 4096

  less:
    name: less
    params:
      cache_dir: ../dataflex_saves/less_output
      gradient_type: adam
      proj_dim: 4096
      seed: 123

  loss:
    name: loss
    params:
      cache_dir: ../dataflex_saves/loss_output
      focus: "medium"

  delta_loss:
    name: delta_loss
    params:
      cache_dir: ../dataflex_saves/delta_loss_output
      window_size: 0.2

  tsds:
    name: tsds
    params:
      probs_path: ./src/dataflex/offline_selector/tsds_probs.npy
      cache_dir: ../dataflex_saves/tsds_output
  
  random:
    name: random
    params:
      cache_dir: ../dataflex_saves/random_output
      seed: 42
      replacement: false

  custom:
    name: custom
    params:
      cache_dir: ../dataflex_saves/custom_output

mixers:
  # 动态数据混合器
  random:
    name: random
    params:
      seed: 42
  
  doremi:
    name: doremi
    params:
      # Path to the reference model checkpoint (Step 1 of DoReMi)
      # reference_model_path: /path/to/ckpt/Qwen2.5-0.5B
      reference_model_path: /path/to/dataflex_saves/Qwen2.5-0.5B/doremi_step1_static_qwen_pt_full_result/checkpoint-xxx
      # # Set to null if no reference model available
      # reference_model_path: null
      # # Use proxy model as reference (for cases where no separate reference model exists)
      # use_proxy_as_reference: true
      # Learning rate for domain weight updates (eta in the paper)
      reweight_eta: 1.0
      # Smoothing parameter for domain weights (epsilon in the paper)
      reweight_eps: 1e-3
      # Number of samples to evaluate per domain
      num_eval_samples: 1000
      # Batch size for computing excess loss
      eval_batch_size: 8
  
  # 静态数据混合器 - 用于DoReMi算法的Step 1和Step 3
  static:
    name: static
    params:
      # 固定比例，如果不指定则使用均匀分布
      proportions: [0.5, 0.5]  # 对应各个域的比例
      # proportions: null  # 使用均匀分布
      # proportions: [0.541, 0.287, 0.042, 0.037, 0.034, 0.031, 0.028] # For SlimePajama-6B dataset

weighters:
  # 动态数据加权器
  loss:
    name: loss
    params:
      strategy: linupper # choices: [linupper, uniform, quadratic, extremes]
      delta: 1.0
  
  custom:
    name: custom
    params:
      strategy: uniform
